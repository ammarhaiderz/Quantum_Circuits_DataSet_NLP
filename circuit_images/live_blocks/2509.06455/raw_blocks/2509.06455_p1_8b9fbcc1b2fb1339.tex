\begin{quantikz}
    \lstick{$\ket{\phi}$}\slice{t=0} & \slice{t=1} & \slice{t=2} & \ctrl{3}\slice{t=3} & \slice{t=4} & \slice{t=5} & & \slice{t=6} & \slice{t=7} & \slice{t=8} & \gate{Z}\slice{t=9} & \\
    \lstick{$\ket{x_1}$} & & & & & & \targ{} & & & & & \\
    \lstick{$\ket{x_2}$} & & & & & & & \targ{} & & & & \\
    \lstick{$\ket{0}$} & \gate{H} & \ctrl{1} & \targ{} & \meter{} & \ctrl[vertical wire=c]{1}\setwiretype{c} \\
    \lstick{$\ket{0}$} & & \targ{} & \targ{} & \meter{} & \ctrl[vertical wire=c]{1}\setwiretype{c} \\
    \lstick{$\ket{0}$} & \gate{H} & \ctrl{1} & \ctrl{-1} & & \targ{} & \ctrl{-4} & & \gate{H} & \meter{} & \ctrl[vertical wire=c]{-5}\setwiretype{c} & \setwiretype{n} \\
    \lstick{$\ket{0}$} & & \targ{} & \targ{} & \meter{} & \ctrl[vertical wire=c]{1}\wire[u][1]{c}\setwiretype{c} & \setwiretype{n} \\
    \lstick{$\ket{0}$} & \gate{H} & & \ctrl{-1} & & \targ{} & & \ctrl{-5} & \gate{H} & \meter{} &  \ctrl[vertical wire=c]{-2}\setwiretype{c} & \setwiretype{n} 
    \end{quantikz}