\begin{quantikz}
        \lstick[2]{$\ket{0}^{\otimes r}$} & \gate{\mathbf{H}} & \ctrl{1} && \gate{M_2} & \rstick[4]{$\ket{\psi_e}$}\\
        & & \gate[3]{M_1} & \gate{\mathbf{H}} & \ctrl{1}\wire[u]{q} &\\
        \lstick{$\ket{0}^{\otimes l}$} & \gate{\bar{X}} &&& \gate[2]{M_2} &\\
        \lstick{$\ket{\psi_i}\;\;$} & \ctrl{-1} &&&&\\
    \end{quantikz}