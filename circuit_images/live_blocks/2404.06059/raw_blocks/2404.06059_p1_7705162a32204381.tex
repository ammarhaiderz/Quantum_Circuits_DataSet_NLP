\Qcircuit @C=0.85em @R=1em @!R{
    \lstick{\ket{a}} & \ctrl{1} & \qw &&& \qw & \qw & \qw & \ctrl{1} & \qw & \qw & \qw & \qw & \rstick{\ket{a}} \\
    \lstick{\ket{b_1}} & \targ \qwx[1] & \qw &&& \ctrl{1} & \ctrl{2} & \ctrl{4} & \targ & \ctrl{4} & \ctrl{2} & \ctrl{1} & \qw & \rstick{\ket{b_1 \oplus a}} \\
    \lstick{\ket{b_2}} & \targ \qwx[1] & \qw &&& \targ & \qw & \qw & \qw & \qw & \qw & \targ & \qw & \rstick{\ket{b_2 \oplus a}} \\
    \lstick{\ket{b_3}} & \targ \qwx[1] & \qw &&& \ctrl{1} & \targ & \qw & \qw & \qw & \targ & \ctrl{1} & \qw & \rstick{\ket{b_3 \oplus a}} \\
    \lstick{\ket{b_4}} & \targ \qwx[1] & \qw &\push{=}&& \targ & \qw & \qw & \qw & \qw & \qw & \targ & \qw & \rstick{\ket{b_4 \oplus a}} \\
    \lstick{\ket{b_5}} & \targ \qwx[1] & \qw &&& \ctrl{1} & \ctrl{2} & \targ & \qw & \targ & \ctrl{2} & \ctrl{1} & \qw & \rstick{\ket{b_5 \oplus a}} \\
    \lstick{\ket{b_6}} & \targ \qwx[1] & \qw &&& \targ & \qw & \qw & \qw & \qw & \qw & \targ & \qw & \rstick{\ket{b_6 \oplus a}} \\
    \lstick{\ket{b_7}} & \targ \qwx[1] & \qw &&& \ctrl{1} & \targ & \qw & \qw & \qw & \targ & \ctrl{1} & \qw & \rstick{\ket{b_7 \oplus a}} \\
    \lstick{\ket{b_8}} & \targ & \qw &&& \targ & \qw & \qw & \qw & \qw & \qw & \targ & \qw & \rstick{\ket{b_8 \oplus a}}
}