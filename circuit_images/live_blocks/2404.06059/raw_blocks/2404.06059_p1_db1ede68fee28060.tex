\Qcircuit @C=1.7em @R=1.2em @!R{
    \lstick{\ket{x_1}} & \qw & \qw & \qw & \qw & \qw & \qw & \ctrl{3} & \qw \\
    \lstick{\ket{x_2}} & \qw & \qw & \qw & \qw & \ctrl{2} & \ctrl{6} & \qw & \qw \\
    \lstick{\ket{x_3}} & \ctrl{1} & \ctrl{3} & \ctrl{5} & \ctrl{7} & \qw & \qw & \qw & \qw \\
    \lstick{\ket{a_{000}}} & \qswap \qwx[1] & \qw & \qw & \qw & \qswap \qwx[2] & \qw & \qswap \qwx[4] & \qw \\
    \lstick{\ket{a_{001}}} & \qswap & \qw & \qw & \qw & \qw & \qw & \qw & \qw \\
    \lstick{\ket{a_{010}}} & \qw & \qswap \qwx[1] & \qw & \qw & \qswap & \qw & \qw & \qw \\
    \lstick{\ket{a_{011}}} & \qw & \qswap & \qw & \qw & \qw & \qw & \qw & \qw \\
    \lstick{\ket{a_{100}}} & \qw & \qw & \qswap \qwx[1] & \qw & \qw & \qswap \qwx[2] & \qswap & \qw \\
    \lstick{\ket{a_{101}}} & \qw & \qw & \qswap & \qw & \qw & \qw & \qw & \qw \\
    \lstick{\ket{a_{110}}} & \qw & \qw & \qw & \qswap \qwx[1] & \qw & \qswap & \qw & \qw \\
    \lstick{\ket{a_{111}}} & \qw & \qw & \qw & \qswap & \qw & \qw & \qw & \qw \\
}