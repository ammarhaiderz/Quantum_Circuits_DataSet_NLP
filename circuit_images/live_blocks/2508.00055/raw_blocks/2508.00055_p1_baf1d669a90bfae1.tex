\Qcircuit @R=1em @C=1em {
%
\lstick{\ket{0}_{\reg{K}}}
    & \qw
    & \qw
    & \multigate{4}{\unctrl(U, \tmpop_1)}
    & \qw
    & \multigate{4}{\unctrl(U, \tmpop_2)}
    & \qw
    & {\cdots}
    &
    & \qw
    & \multigate{4}{\unctrl(U, \tmpop_n)}
    & \qw
    & \qw  \\
\lstick{}
    & \qw
    & \qw
    & \ghost{\unctrl(U, \tmpop_1)}
    & \qw
    & \ghost{\unctrl(U, \tmpop_2)}
    & \qw
    & {\cdots}
    &
    & \qw
    & \ghost{\unctrl(U, \tmpop_n)}
    & \qw
    & \qw  \\
\lstick{}
    & \qw
    & \qw
    & \ghost{\unctrl(U, \tmpop_1)}
    & \qw
    & \ghost{\unctrl(U, \tmpop_2)}
    & \qw
    & {\cdots}
    &
    & \qw
    & \ghost{\unctrl(U, \tmpop_n)}
    & \qw
    & \qw
    \inputgroupv{2}{3}{1em}{1em}{\ket{\Phi}_{\reg{H},\reg{H^{\trans}}} \hspace{2em}} \\
\lstick{\ket{0}_{\reg{R}}}
    & \qw
    & \multigate{2}{A^{(1)}}
    & \ghost{\unctrl(U, \tmpop_1)}
    & \multigate{2}{A^{(2)}}
    & \ghost{\unctrl(U, \tmpop_2)}
    & \qw
    & {\cdots}
    &
    & \multigate{2}{A^{(n)}}
    & \ghost{\unctrl(U, \tmpop_n)}
    & \multigate{2}{A^{(n+1)}}
    & \qw  \\
\lstick{\ket{0}_{\reg{C}}}
    & \qw
    & \ghost{A^{(1)}}
    & \ghost{\unctrl(U, \tmpop_1)}
    & \ghost{A^{(2)}}
    & \ghost{\unctrl(U, \tmpop_2)}
    & \qw
    & {\cdots}
    &
    & \ghost{A^{(n)}}
    & \ghost{\unctrl(U, \tmpop_n)}
    & \ghost{A^{(n+1)}}
    & \qw  \\
\lstick{\ket{0}_{\reg{S}}}
    & \qw
    & \ghost{A^{(1)}}
    & \qw
    & \ghost{A^{(2)}}
    & \qw
    & \qw
    & {\cdots}
    &
    & \ghost{A^{(n)}}
    & \qw
    & \ghost{A^{(n+1)}}
    & \qw  \\
}