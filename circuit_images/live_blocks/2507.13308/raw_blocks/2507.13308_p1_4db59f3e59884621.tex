\begin{quantikz}[row sep=0.45cm, column sep=0.2cm]
   \lstick[4]{$\ell$} 
        &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|0\rangle$}       & \gate{H}  & \qw  & \qw     & \ctrl{4}       & \qw             & \ldots\ldots    & \qw     & \qw           & \gate{H} & \meter{0} & \qw \\
    &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|0\rangle$}       & \gate{H}  & \qw & \qw   & \qw            & \ctrl{10}          & \ldots\ldots   & \qw     & \qw  &\gate{H}                               & \meter{0} & \qw \\
    &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$\vdots$}                                                                                          \\
    &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|0\rangle$}   & \gate{H}     & \qw            & \qw             & \qw  & \qw     & \ldots \ldots     & \ctrl{11}  & \qw   &\gate{H}                                & \meter{0} & \qw \\
      \lstick[4]{$n$} 
        &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\psi(s,p)\rangle$} &  \gateO{*} \vqw{4}   & \qw          & \qw &  \gate[wires=4]{U(1)}  & \qw   & \ldots \ldots       & \qw   & \qw  & \qw &  \gateO{*} \vqw{4} & \qw  \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\psi(s,p)\rangle$}      & \qw & \gateO{*} \vqw{4}         & \qw   & \qw  & \qw   & \ldots \ldots       & \qw   & \qw & \gateO{*} \vqw{4}  & \qw & \qw  \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$\vdots$}   \\
        &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\psi(s,p)\rangle$}      & \qw          & \qw & \gateO{*} \vqw{4} & \qw  & \qw   & \ldots \ldots       & \qw  & \gateO{*} \vqw{4} & \qw  & \qw & \qw  \\  
    \lstick[4]{$n$} 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\underline{0}\rangle$} & \gate{\rm SUM} \vqw{6}    & \qw          & \qw   & \qw  &  \gate[wires=4]{U(2)}  & \ldots \ldots       & \qw   & \qw  & \qw   & \gate{\rm SUM^{\dagger}} \vqw{6} & \qw  \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\underline{0}\rangle$}      & \qw    & \gate{\rm SUM} \vqw{6}       & \qw   & \qw  & \qw   & \ldots \ldots       & \qw   & \qw & \gate{\rm SUM^{\dagger}} \vqw{6} & \qw  & \qw  \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$\vdots$}   \\
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\underline{0}\rangle$}      & \qw          & \qw  & \gate{\rm SUM} \vqw{6}  & \qw  & \qw   & \ldots \ldots       & \qw & \gate{\rm SUM^{\dagger}} \vqw{6}   & \qw  & \qw  & \qw \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$\vdots$}      \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$\vdots$}      \\
     \lstick[4]{$n$} 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\underline{0}\rangle$}  & \gate{\rm SUM}   & \qw          & \qw   & \qw  & \qw   & \ldots \ldots       &   \gate[wires=4]{U(\ell)}    & \qw & \qw &  \gate{\rm SUM^{\dagger}} & \qw \\ 
     &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\underline{0}\rangle$}      & \qw  & \gate{\rm SUM}         & \qw   & \qw  & \qw   & \ldots \ldots         & \qw  & \qw & \gate{\rm SUM^{\dagger}} & \qw & \qw   \\ 
    &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$\vdots$}   \\
    &\wireoverride{n} 
        &\wireoverride{n}
         &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
          &\wireoverride{n}
           &\wireoverride{n}
          &\wireoverride{n}
    \lstick{$|\underline{0}\rangle$}      & \qw          & \qw  & \gate{\rm SUM}  & \qw  & \qw   & \ldots \ldots      & \qw & \gate{\rm SUM^{\dagger}}  & \qw & \qw & \qw 
\end{quantikz}