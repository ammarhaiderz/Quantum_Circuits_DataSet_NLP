\begin{quantikz}
\lstick[5]{\ket{\psi}} &  & \gate[5]{U_{\text{QFT}}^\dag} & \gate[5]{U_{\text{MADD}}[M/2]} & \targX{} &  &  &  \\[-0cm]
 &  &  &  & \targX{} &  &  &  \\[-0cm]
\setwiretype{n}\vdots & \vdots & \vdots &  & \vdots & \vdots & \vdots & \\
 &  &  &  & \targX{} &  &  &  \\[-0cm]
 & \qwbundle{n-m} &  &  &  &  & 
\meter{0/1}\arrow[r] & \rstick{\ket{0}} \\
\lstick{\ket{0}} & \qwbundle{m} & \gate{H^{\otimes m}} & \gate{U_{\text{ph}}[g_{M,M/2,x}]} & \targX{} &  &  &  \\
\lstick{\ket{0}} & \qw & \qw & \gate{H} & \ctrl{-6} & \gate{H} & \meter{0/1}\arrow[r] & \rstick{\ket{0}}
\end{quantikz}