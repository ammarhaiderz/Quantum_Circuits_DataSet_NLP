\begin{quantikz}[transparent]
\lstick{\ket{0}} & \qwbundle{m_1} & \gate[5]{U_\psi} & \gate[4]{U_{\text{ext},0}} &  & \gate[4]{U_{\text{QFT}}^\dag} &  & \gate[2]{H^{\otimes (m_1+m_2)}} &  & \meter{0/1} & \rstick[2]{$e_{0,0},\ldots,e_{M_1-1,M_2-1}$} \\[-0cm]
\lstick{\ket{0}} & \qwbundle{m_2} &  & \linethrough & \gate[5,label style={yshift=-0.3cm}]{U_{\text{ext},0}} & \linethrough & \gate[5]{U_{\text{QFT}}^\dag} &  &  & \meter{0/1} &  \\[-0cm]
\lstick{\ket{0}} & \qwbundle{n_1-m_1} &  &  & \linethrough &  &  &  &  & \meter{0/1}\arrow[r] &
\rstick{\ket{0}} \\[-0cm]
\lstick{\ket{0}} &  & \linethrough &  & \linethrough &  &  &  &  & \meter{0/1}\arrow[r] & \rstick{\ket{0}} \\[-0cm]
\lstick{\ket{0}} & \qwbundle{n_2-m_2} &  &  &  &  &  &  &  & \meter{0/1}\arrow[r] &
\rstick{\ket{0}} \\
\lstick{\ket{0}} & \qw &  &  &  &  &  &  &  & \meter{0/1}\arrow[r] &
\rstick{\ket{0}} \\
\lstick{\ket{0}} & \gate{H} & \ctrl{-2} & \ctrl{-3} & \ctrl{-1} & \ctrl{-3} & \ctrl{-1} & \octrl{-5} & \gate{H} & \meter{0/1}\arrow[r] &
\rstick{\ket{0}} 
\end{quantikz}